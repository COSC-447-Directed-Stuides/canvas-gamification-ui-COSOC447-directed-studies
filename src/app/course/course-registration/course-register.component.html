<section class="tui-container tui-container_adaptive">
    <ng-container *ngIf="!courseNotFound">
        <h1
            [class.tui-skeleton]="showSkeletons"
            [class.tui-skeleton_text]="showSkeletons"
            class="tui-text_h3 tui-space_vertical-10"
        >
            Registration for {{courseName}}
        </h1>
        <div *ngIf="showSkeletons"
             class="course-registration_skeleton-notification tui-skeleton tui-space_bottom-7"></div>
        <div *ngIf="showSkeletons" class="course-registration_skeleton tui-skeleton"></div>
        <ng-container *ngIf="registered && !showSkeletons">
            <tui-notification status="success">
                You are already registered in this course
            </tui-notification>
            <div class="tui-form__buttons">
                <a [routerLink]="['/course', courseId]" class="tui-form__button" size="m" tuiButton type="button">
                    Open Course
                </a>
            </div>
        </ng-container>
        <ng-container *ngIf="blocked && !showSkeletons">
            <tui-notification status="error">
                Registration has been blocked for you. Please contact your instructor.
            </tui-notification>
        </ng-container>
        <ng-container *ngIf="!registered && !blocked && !showSkeletons">
            <tui-notification class="tui-space_bottom-7" status="info">
                Before completing registration, make sure you are also registered in the same class on Canvas.
            </tui-notification>
            <app-course-registration-stepper
                #stepper
                [steps]="['Enter Name', 'Confirm Identity', 'Verification', 'Registered']"
            >
                <app-course-registration-step>
                    <form (ngSubmit)="onNameFormSubmit()" [formGroup]="nameForm">
                        <div class="tui-space_top-5">
                            <tui-input [tuiTextfieldCleaner]="true"
                                       aria-label="Full Name on Canvas"
                                       formControlName="nameControl">
                                Enter your full name as it appears on Canvas&nbsp;<span class="tui-required"></span>
                            </tui-input>
                            <tui-field-error formControlName="nameControl"></tui-field-error>
                        </div>
                        <div class="tui-form__buttons">
                            <button [disabled]="true" appearance="secondary" aria-label="Previous"
                                    class="tui-form__button" size="m"
                                    tuiButton
                                    type="button">
                                Prev
                            </button>
                            <button [showLoader]="loadingContent" aria-label="Next" class="tui-form__button" size="m"
                                    tuiButton
                                    type="submit">
                                Next
                            </button>
                        </div>
                    </form>
                </app-course-registration-step>
                <app-course-registration-step>
                    <form (ngSubmit)="onConfirmationFormSubmit()"
                          [formGroup]="needsStudentNumber ? studentNumberForm : confirmNameForm">
                        <ng-container *ngIf="needsStudentNumber">
                            <div class="tui-space_top-5">
                                <tui-input [tuiTextfieldCleaner]="true"
                                           aria-label="Student Number"
                                           formControlName="studentNumberControl">
                                    Student Number&nbsp;<span class="tui-required"></span>
                                </tui-input>
                                <tui-field-error formControlName="studentNumberControl"></tui-field-error>
                            </div>
                        </ng-container>
                        <ng-container *ngIf="!needsStudentNumber">
                            <div class="tui-space_top-5">
                                <tui-input [readOnly]="true"
                                           [tuiTextfieldCleaner]="true"
                                           aria-label="Confirm Name"
                                           formControlName="confirmNameControl">
                                    Please confirm that this is your name.&nbsp;<span class="tui-required"></span>
                                </tui-input>
                                <tui-field-error formControlName="confirmNameControl"></tui-field-error>
                            </div>
                        </ng-container>
                        <div class="tui-form__buttons">
                            <button (click)="stepper.setPrevStep()" appearance="secondary" aria-label="Previous"
                                    class="tui-form__button" size="m"
                                    tuiButton
                                    type="button">Prev
                            </button>
                            <button [showLoader]="loadingContent" aria-label="Next" class="tui-form__button" size="m"
                                    tuiButton
                                    type="submit">
                                Next
                            </button>
                        </div>
                    </form>
                </app-course-registration-step>
                <app-course-registration-step>
                    <form (ngSubmit)="onVerificationFormSubmit()" [formGroup]="verifyForm">
                        <div class="tui-space_top-5">
                            <tui-input [textMask]="verificationNumberMask"
                                       [tuiTextfieldCleaner]="true"
                                       aria-label="Verification Code" formControlName="verifyControl">
                                Verification Code&nbsp;<span class="tui-required"></span>
                            </tui-input>
                            <tui-field-error formControlName="verifyControl"></tui-field-error>
                        </div>
                        <div class="tui-space_top-3">
                            <tui-notification status="{{attemptsRemaining < 3 ? 'error' : 'info'}}">
                                <span *ngIf="attemptsRemaining >= 1">
                                    Attempts Remaining: {{ attemptsRemaining }}
                                </span>
                                <span *ngIf="attemptsRemaining < 1">
                                    You don't have any attempts remaining! Contact your instructor.
                                </span>
                            </tui-notification>
                        </div>
                        <div class="tui-form__buttons">
                            <button [disabled]="true" appearance="secondary" aria-label="Previous"
                                    class="tui-form__button" size="m"
                                    tuiButton
                                    type="button">
                                Prev
                            </button>
                            <button [showLoader]="loadingContent" aria-label="Next" class="tui-form__button" size="m"
                                    tuiButton
                                    type="submit">
                                Next
                            </button>
                        </div>
                    </form>
                </app-course-registration-step>
                <app-course-registration-step>
                    <p class="tui-space_top-5">Registration Complete.</p>
                    <div class="tui-form__buttons">
                        <button [disabled]="true" appearance="secondary" aria-label="Previous" class="tui-form__button"
                                size="m"
                                tuiButton
                                type="button">
                            Prev
                        </button>
                        <a [routerLink]="['/course', courseId]" class="tui-form__button" size="m" tuiButton
                           type="button">
                            Open Course
                        </a>
                    </div>
                </app-course-registration-step>
            </app-course-registration-stepper>
        </ng-container>
    </ng-container>
    <ng-container *ngIf="courseNotFound">
        <div class="course-registration_none">
            <tui-marker-icon
                class="tui-space_bottom-4 tui-space_top-15"
                mode="error"
                size="s"
                src="tuiIconAlertCircleLarge"
            ></tui-marker-icon>
            <h1 class="tui-text_h6 tui-island_text-align_center">
                Unable to find the course for registration.
            </h1>
            <p class="tui-island__paragraph">
                Please try again later, or contact your course administrator.
            </p>
        </div>
    </ng-container>
</section>
